<%- include('../partials/header', { title: 'Account Management - SecureBank Admin' }) %>

<div class="admin-accounts">
    <div class="container-fluid">
        <!-- Page Header -->
        <div class="dashboard-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="dashboard-title">
                        <i class="fas fa-users me-3"></i>Account Management
                    </h1>
                    <p class="dashboard-subtitle">Manage customer accounts, approvals, and account settings</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <div class="dashboard-actions">
                        <button class="btn btn-success me-2" data-bs-toggle="modal" data-bs-target="#createAccountModal">
                            <i class="fas fa-plus me-2"></i>Create Account
                        </button>
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                                <i class="fas fa-filter me-2"></i>Filter
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="?status=all">All Accounts</a></li>
                                <li><a class="dropdown-item" href="?status=active">Active</a></li>
                                <li><a class="dropdown-item" href="?status=pending">Pending</a></li>
                                <li><a class="dropdown-item" href="?status=blocked">Blocked</a></li>
                                <li><a class="dropdown-item" href="?status=closed">Closed</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="row g-4 mb-4">
            <div class="col-lg-3 col-md-6">
                <div class="stat-card success">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value"><%= stats.active %></h3>
                        <p class="stat-label">Active Accounts</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-card warning">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value"><%= stats.pending %></h3>
                        <p class="stat-label">Pending Approval</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-card danger">
                    <div class="stat-icon">
                        <i class="fas fa-ban"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value"><%= stats.blocked %></h3>
                        <p class="stat-label">Blocked Accounts</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="stat-card info">
                    <div class="stat-icon">
                        <i class="fas fa-university"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-value">â‚¹<%= (stats.totalBalance / 100000).toFixed(1) %>L</h3>
                        <p class="stat-label">Total Deposits</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search and Filter -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <form method="GET" class="row g-3 align-items-end">
                            <div class="col-md-4">
                                <label for="search" class="form-label">Search Accounts</label>
                                <input type="text" class="form-control" id="search" name="search" 
                                       placeholder="Name, email, or account number" 
                                       value="<%= search || '' %>">
                            </div>
                            <div class="col-md-2">
                                <label for="status" class="form-label">Status</label>
                                <select class="form-select" id="status" name="status">
                                    <option value="all" <%= filter.status === 'all' ? 'selected' : '' %>>All</option>
                                    <option value="active" <%= filter.status === 'active' ? 'selected' : '' %>>Active</option>
                                    <option value="pending" <%= filter.status === 'pending' ? 'selected' : '' %>>Pending</option>
                                    <option value="blocked" <%= filter.status === 'blocked' ? 'selected' : '' %>>Blocked</option>
                                    <option value="closed" <%= filter.status === 'closed' ? 'selected' : '' %>>Closed</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="accountType" class="form-label">Type</label>
                                <select class="form-select" id="accountType" name="accountType">
                                    <option value="all" <%= filter.accountType === 'all' ? 'selected' : '' %>>All</option>
                                    <option value="savings" <%= filter.accountType === 'savings' ? 'selected' : '' %>>Savings</option>
                                    <option value="current" <%= filter.accountType === 'current' ? 'selected' : '' %>>Current</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <label for="sortBy" class="form-label">Sort By</label>
                                <select class="form-select" id="sortBy" name="sortBy">
                                    <option value="newest" <%= sort === 'newest' ? 'selected' : '' %>>Newest First</option>
                                    <option value="oldest" <%= sort === 'oldest' ? 'selected' : '' %>>Oldest First</option>
                                    <option value="balance-high" <%= sort === 'balance-high' ? 'selected' : '' %>>Highest Balance</option>
                                    <option value="balance-low" <%= sort === 'balance-low' ? 'selected' : '' %>>Lowest Balance</option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-search me-2"></i>Search
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Accounts Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-list me-2"></i>Customer Accounts</h5>
                        <div class="card-actions">
                            <button class="btn btn-sm btn-outline-success" onclick="exportAccounts()">
                                <i class="fas fa-download me-1"></i>Export
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <% if (accounts.length > 0) { %>
                            <div class="table
